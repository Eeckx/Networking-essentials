<section>
  <h1>ğŸŒ Routing and Remote Access Service (RRAS) â€“ Installatie, Configuratie en VPN</h1>

  <section>
    <h2>ğŸ¯ Doelstelling</h2>
    <p>
      In dit lab leer je hoe je <strong>Routing and Remote Access (RRAS)</strong> installeert en configureert op Windows Server.
      RRAS maakt het mogelijk om de server te gebruiken als <strong>router, NAT-server of VPN-toegangspunt</strong>.
      Je leert zowel LAN-routing als VPN-functionaliteit in te stellen voor veilige externe toegang.
    </p>
  </section>

  <section>
    <h2>ğŸ§° Voorwaarden</h2>
    <ul>
      <li>Windows Server 2019, 2022 of nieuwer</li>
      <li>Minstens 2 netwerkinterfaces:
        <ul>
          <li>1 interne interface (LAN)</li>
          <li>1 externe interface (Internet)</li>
        </ul>
      </li>
      <li>Statisch IP-adres</li>
      <li>Administratorrechten</li>
      <li>(Optioneel) Active Directory-integratie voor VPN-authenticatie</li>
    </ul>
  </section>

  <section>
    <h2>âš™ï¸ Installatie van RRAS</h2>
    <ol>
      <li>Open <strong>Server Manager â†’ Add Roles and Features</strong>.</li>
      <li>Kies <strong>Role-based or feature-based installation</strong>.</li>
      <li>Selecteer <strong>Remote Access</strong> â†’ klik <strong>Next</strong>.</li>
      <li>Onder <strong>Role Services</strong>, vink aan:
        <ul>
          <li><strong>DirectAccess and VPN (RAS)</strong></li>
          <li><strong>Routing</strong></li>
        </ul>
      </li>
      <li>Klik <strong>Install</strong>.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
Install-WindowsFeature -Name RemoteAccess,Routing -IncludeManagementTools
        </code></pre>
      </li>
    </ol>
  </section>

  <section>
    <h2>ğŸš€ Configuratie van RRAS</h2>
    <h3>Stap 1 â€“ Service configureren</h3>
    <ol>
      <li>Open <strong>Server Manager â†’ Tools â†’ Routing and Remote Access</strong>.</li>
      <li>Rechtsklik op je servernaam â†’ <strong>Configure and Enable Routing and Remote Access</strong>.</li>
      <li>De wizard verschijnt â€” kies Ã©Ã©n van de volgende scenarioâ€™s:
        <ul>
          <li><strong>Network Address Translation (NAT)</strong> â€“ deel internet via Ã©Ã©n WAN-interface.</li>
          <li><strong>VPN access</strong> â€“ laat externe gebruikers inloggen via VPN.</li>
          <li><strong>Custom Configuration</strong> â€“ voor combinaties zoals LAN routing + VPN.</li>
        </ul>
      </li>
      <li>Kies <strong>Custom Configuration</strong> â†’ selecteer:
        <ul>
          <li><strong>VPN access</strong></li>
          <li><strong>LAN routing</strong></li>
        </ul>
      </li>
      <li>Klik <strong>Finish</strong> â†’ <strong>Start the service</strong>.</li>
    </ol>
  </section>

  <section>
    <h2>ğŸŒ NAT-configuratie</h2>
    <ol>
      <li>Open in de RRAS-console: <strong>IPv4 â†’ NAT</strong>.</li>
      <li>Rechtsklik â†’ <strong>New Interfaceâ€¦</strong>.</li>
      <li>Selecteer je externe (Internet) netwerkinterface â†’ klik <strong>Public interface connected to the Internet</strong>.</li>
      <li>Vink aan: <strong>Enable NAT on this interface</strong>.</li>
      <li>Herhaal voor de interne interface, maar kies <strong>Private interface connected to private network</strong>.</li>
      <li>Clients kunnen nu via DHCP of statisch IP het interne subnet gebruiken met deze server als gateway.</li>
    </ol>

    <h3>PowerShell alternatief</h3>
    <pre><code class="language-powershell">
New-NetNat -Name "LabNAT" -InternalIPInterfaceAddressPrefix "192.168.10.0/24"
    </code></pre>
  </section>

  <section>
    <h2>ğŸ” VPN-configuratie</h2>
    <ol>
      <li>In RRAS-console: rechtsklik op server â†’ <strong>Properties â†’ Security-tab</strong>.</li>
      <li>Onder <strong>Authentication provider</strong> kies:
        <ul>
          <li><strong>Windows Authentication</strong> (voor lokale gebruikers)</li>
          <li><strong>RADIUS</strong> (voor integratie met NPS/AD)</li>
        </ul>
      </li>
      <li>Onder <strong>IPv4-tab</strong> kies:
        <ul>
          <li><strong>Static address pool</strong> (bijv. 192.168.50.10â€“192.168.50.100)</li>
          <li>of <strong>DHCP</strong> als er een DHCP-server beschikbaar is.</li>
        </ul>
      </li>
      <li>Open <strong>Ports â†’ Properties</strong> â†’ controleer dat PPTP en L2TP poorten actief zijn.</li>
    </ol>

    <h3>Firewallpoorten</h3>
    <ul>
      <li>PPTP: TCP 1723</li>
      <li>L2TP/IPsec: UDP 500, UDP 1701, UDP 4500</li>
      <li>SSTP (via HTTPS): TCP 443</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ§¾ VPN-protocollen en opties</h2>
    <ul>
      <li><strong>PPTP</strong> â€“ eenvoudig, maar minder veilig. Alleen gebruiken in testomgevingen.</li>
      <li><strong>L2TP/IPsec</strong> â€“ veilige optie met certificaten of pre-shared key.</li>
      <li><strong>SSTP</strong> â€“ werkt over HTTPS, ideaal voor firewalls/NAT (vereist servercertificaat).</li>
      <li><strong>IKEv2</strong> â€“ modern protocol met snelle reconnects en sterke beveiliging (vanaf Server 2016).</li>
    </ul>

    <p>
      Voor <strong>L2TP/IPsec</strong> en <strong>SSTP</strong> moet je een geldig certificaat installeren op de RRAS-server.
      Dit kan via <strong>Active Directory Certificate Services</strong> of een publieke CA.
    </p>
  </section>

  <section>
    <h2>ğŸ‘¤ VPN-gebruikers configureren</h2>
    <ol>
      <li>Open <strong>Active Directory Users and Computers</strong>.</li>
      <li>Dubbelklik op de gebruiker â†’ tab <strong>Dial-in</strong>.</li>
      <li>Kies:
        <ul>
          <li><strong>Allow access</strong> â€“ directe VPN-toegang</li>
          <li><strong>Control access through NPS Network Policy</strong> â€“ voor centrale policies</li>
        </ul>
      </li>
      <li>De gebruiker kan nu verbinding maken via Windows:
        <pre><code>
Settings â†’ Network & Internet â†’ VPN â†’ Add VPN connection
        </code></pre>
      </li>
      <li>Voer servernaam in (bijv. vpn.lab.local) en protocol (PPTP of SSTP).</li>
    </ol>
  </section>

  <section>
    <h2>ğŸ§© LAN-routing (interne netwerken verbinden)</h2>
    <ol>
      <li>Open RRAS-console â†’ <strong>IPv4 â†’ Static Routes</strong>.</li>
      <li>Voeg routes toe naar andere interne netwerken:
        <pre><code>
Destination: 192.168.20.0
Subnet mask: 255.255.255.0
Gateway: 192.168.10.1
        </code></pre>
      </li>
      <li>Clients kunnen nu communiceren tussen VLANs/subnets via RRAS als router.</li>
    </ol>

    <h3>PowerShell alternatief</h3>
    <pre><code class="language-powershell">
New-NetRoute -DestinationPrefix "192.168.20.0/24" -InterfaceAlias "LAN" -NextHop 192.168.10.1
    </code></pre>
  </section>

  <section>
    <h2>ğŸ“œ Logging en monitoring</h2>
    <ul>
      <li>Bekijk actieve verbindingen onder <strong>Remote Access Clients</strong>.</li>
      <li>Controleer logs:
        <ul>
          <li><code>%SystemRoot%\System32\LogFiles\</code></li>
          <li>Event Viewer â†’ Custom Views â†’ Server Roles â†’ Routing and Remote Access</li>
        </ul>
      </li>
      <li>Gebruik <code>Get-RemoteAccessConnectionStatistics</code> voor PowerShell-monitoring.</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ§  Best Practices</h2>
    <ul>
      <li>Gebruik <strong>sterke authenticatie</strong> (MS-CHAPv2, EAP-TLS met certificaten).</li>
      <li>Gebruik <strong>SSTP</strong> of <strong>IKEv2</strong> voor maximale beveiliging.</li>
      <li>Segmenteer VPN-verkeer op een apart subnet.</li>
      <li>Gebruik NPS (Network Policy Server) voor centrale toegangscontrole en accounting.</li>
      <li>Gebruik logging en monitor actieve verbindingen.</li>
      <li>Overweeg redundantie met meerdere RRAS-servers.</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ§¾ Conclusie</h2>
    <p>
      Met RRAS kan een Windows Server dienen als krachtige router of VPN-server.
      Door LAN-routing, NAT en VPN te combineren, creÃ«er je een veilige, flexibele netwerkverbinding
      tussen interne netwerken en externe gebruikers.
      RRAS is een essentieel onderdeel van elke geavanceerde Windows-infrastructuur.
    </p>
  </section>
</section>
