<article>
  <h1>Hyper-V Remote Desktop Services (RDS) Lab</h1>

  <section>
    <h2>üéØ Doelstelling</h2>
    <p>
      Dit lab leert je hoe je een volledige Remote Desktop Services (RDS)-omgeving opzet en beheert binnen een Hyper-V infrastructuur.
      Je leert stap voor stap de RDS-rollen installeren, configureren, gebruikerssessies beheren, RDS licensing instellen en beveiliging toepassen via SSL en policies.
      Daarnaast ontdek je de uitbreidingsmogelijkheden zoals Web Access, RemoteApp publicatie en Gateway-toegang voor externe gebruikers.
    </p>
  </section>

  <section class="infra-table">
    <h3>üß© Benodigde infrastructuur</h3>
    <table>
      <thead>
        <tr>
          <th>Component</th>
          <th>Minimumvereisten</th>
          <th>Aanbevolen</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Host OS</td>
          <td>Windows Server 2019 of 2022</td>
          <td>Windows Server 2022 Datacenter</td>
        </tr>
        <tr>
          <td>VM-configuratie</td>
          <td>2 vCPU, 4 GB RAM, 40 GB HDD</td>
          <td>4 vCPU, 8 GB RAM, 60 GB SSD</td>
        </tr>
        <tr>
          <td>Rollen</td>
          <td>Session Host, Licensing</td>
          <td>Session Host, Connection Broker, Web Access, Gateway</td>
        </tr>
        <tr>
          <td>Netwerk</td>
          <td>Internal switch</td>
          <td>Internal + External switch voor remote toegang</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>üèóÔ∏è Installatie en Configuratie van RDS</h2>

    <h3>Stap 1 ‚Äì Voorbereiding</h3>
    <ul>
      <li>Controleer dat de server lid is van het domein (<code>lab.local</code>).</li>
      <li>Controleer DNS-resolutie en netwerkconnectiviteit.</li>
      <li>Maak eventueel een aparte OU in AD voor RDS-servers.</li>
      <li>Voeg de gebruikers toe die toegang mogen krijgen (bijv. <code>LabUsers</code> groep).</li>
    </ul>

    <h3>Stap 2 ‚Äì Installatie van RDS-rollen</h3>
    <ol>
      <li>Open <strong>Server Manager ‚Üí Add Roles and Features</strong>.</li>
      <li>Kies <strong>Remote Desktop Services installation</strong> in plaats van de standaard ‚ÄúRole-based‚Äù installatie.</li>
      <li>Kies implementatietype:
        <ul>
          <li><strong>Standard deployment:</strong> Voor productie, meerdere servers mogelijk</li>
          <li><strong>Quick Start:</strong> Alles op √©√©n server (ideaal voor lab)</li>
        </ul>
      </li>
      <li>Vink volgende rollen aan:
        <ul>
          <li>Remote Desktop Session Host (RDSH)</li>
          <li>Remote Desktop Licensing</li>
          <li>Remote Desktop Connection Broker</li>
          <li>Remote Desktop Web Access</li>
        </ul>
      </li>
      <li>Herstart de server na installatie.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
Install-WindowsFeature RDS-RD-Server, RDS-Licensing, RDS-Connection-Broker, RDS-Web-Access -IncludeManagementTools
        </code></pre>
      </li>
    </ol>

    <h3>Stap 3 ‚Äì RDS-beheer en Collections aanmaken</h3>
    <ol>
      <li>Open <strong>Server Manager ‚Üí Remote Desktop Services ‚Üí Collections ‚Üí Create Session Collection</strong>.</li>
      <li>Geef de collection een naam (bijv. <strong>RDS-Lab-Users</strong>).</li>
      <li>Selecteer de RDSH-server(s) die deel uitmaken van de collection.</li>
      <li>Wijs gebruikers of groepen toe die mogen inloggen (bijv. <code>LabUsers</code>).</li>
      <li>Kies een pad voor gebruikersprofielen (optioneel):
        <pre><code>\\FILE01\Profiles\%USERNAME%</code></pre>
      </li>
    </ol>

    <h3>Stap 4 ‚Äì RDS Licensing configureren</h3>
    <ul>
      <li>Open <strong>Server Manager ‚Üí Remote Desktop Licensing Manager</strong>.</li>
      <li>Activeer de licentie-server via <strong>Activate Server</strong>.</li>
      <li>Kies licentietype:
        <ul>
          <li><strong>Per Device</strong> ‚Äì elke client-PC krijgt een CAL</li>
          <li><strong>Per User</strong> ‚Äì gebruikers kunnen van meerdere apparaten inloggen</li>
        </ul>
      </li>
      <li>Voeg licentiesleutels toe indien beschikbaar.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
Set-RDLicenseConfiguration -LicenseServer "RDS01.lab.local" -Mode PerUser
        </code></pre>
      </li>
    </ul>

    <h3>Stap 5 ‚Äì Beveiliging en certificaten</h3>
    <ul>
      <li>Gebruik een SSL-certificaat voor de RDS Web Access en Gateway componenten.</li>
      <li>In de RDS Deployment Properties ‚Üí Certificates:
        <ul>
          <li>Importeer een domein- of zelfondertekend certificaat (.pfx).</li>
          <li>Koppel dit aan alle RDS-componenten (Broker, Web Access, Gateway).</li>
        </ul>
      </li>
      <li>PowerShell voorbeeld voor zelfondertekend certificaat:
        <pre><code class="language-powershell">
New-SelfSignedCertificate -DnsName "rds.lab.local" -CertStoreLocation "Cert:\LocalMachine\My"
        </code></pre>
      </li>
      <li>Gebruik Group Policy om beveiligingsinstellingen te versterken:
        <ul>
          <li>Forceer NLA (Network Level Authentication)</li>
          <li>Limiteer sessietijd of idle timeout</li>
          <li>Sta alleen RDP via TLS 1.2 toe</li>
        </ul>
      </li>
    </ul>

    <h3>Stap 6 ‚Äì Web Access configureren</h3>
    <ul>
      <li>Open browser ‚Üí navigeer naar <code>https://rds.lab.local/RDWeb</code>.</li>
      <li>Login met een gebruiker uit de <code>LabUsers</code> groep.</li>
      <li>Controleer dat gepubliceerde apps of desktop beschikbaar zijn.</li>
      <li>Je kunt via Server Manager ‚Üí RemoteApp Programs ‚Üí Publish RemoteApp Programs specifieke apps publiceren (bijv. Notepad, Word, MMC).</li>
    </ul>

    <h3>Stap 7 ‚Äì Gateway instellen (optioneel)</h3>
    <ul>
      <li>Installeer de <strong>Remote Desktop Gateway</strong> rol:
        <pre><code class="language-powershell">
Install-WindowsFeature RDS-Gateway -IncludeManagementTools
        </code></pre>
      </li>
      <li>Gebruik RD Gateway Manager om policies te configureren:
        <ul>
          <li>Maak een <strong>Connection Authorization Policy (CAP)</strong> ‚Äì wie mag verbinden</li>
          <li>Maak een <strong>Resource Authorization Policy (RAP)</strong> ‚Äì welke interne servers bereikbaar zijn</li>
        </ul>
      </li>
      <li>Gebruik een geldig SSL-certificaat voor externe toegang via poort 443.</li>
    </ul>

    <h3>Stap 8 ‚Äì Load balancing en schaalbaarheid</h3>
    <ul>
      <li>Met meerdere RDSH-servers kun je sessies verdelen via de Connection Broker.</li>
      <li>Voeg extra Session Hosts toe via Server Manager ‚Üí Add RDSH servers to collection.</li>
      <li>Gebruik DNS round robin of een hardware load balancer voor Web Access en Gateway redundantie.</li>
    </ul>

    <h3>Stap 9 ‚Äì Testing en validatie</h3>
    <ul>
      <li>Test RDP-verbinding met MSTSC:
        <pre><code>mstsc /v:rds.lab.local</code></pre>
      </li>
      <li>Controleer sessies via Server Manager ‚Üí RDS Collections ‚Üí Sessions.</li>
      <li>Test RemoteApp via browser of Remote Desktop Client.</li>
      <li>Valideer licentiegebruik via RD Licensing Manager.</li>
      <li>Controleer Event Viewer ‚Üí Applications and Services Logs ‚Üí Microsoft ‚Üí Windows ‚Üí TerminalServices-*</li>
    </ul>
  </section>

  <section>
    <h2>üîê Extra mogelijkheden binnen RDS</h2>
    <ul>
      <li><strong>RemoteApp</strong>: publiceer specifieke applicaties i.p.v. volledige desktop.</li>
      <li><strong>Personal Session Desktops</strong>: toewijzen van een vaste RDS-host aan een specifieke gebruiker.</li>
      <li><strong>Profile Disks</strong>: gebruikersprofielen centraal bewaren zodat instellingen behouden blijven tussen sessies.(bijv: FsLogix)</li>
      <li><strong>RDS Gateway + RD Web</strong>: externe toegang via √©√©n beveiligd HTTPS-portaal.</li>
      <li><strong>GPU acceleration</strong> (indien ondersteund): optimaliseer grafische prestaties voor zware applicaties.</li>
      <li><strong>Group Policy beheer</strong>: instellen van sessietijden, printer redirectie, schijf-mapping, clipboard-toegang, enz.</li>
    </ul>
  </section>

  <section class="infra-table">
    <h3>üìä Troubleshooting</h3>
    <table>
      <thead>
        <tr>
          <th>Probleem</th>
          <th>Oplossing</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Geen verbinding mogelijk via RDP</td>
          <td>Controleer firewall, RDP-service, NLA-instellingen en certificaatbinding.</td>
        </tr>
        <tr>
          <td>Licentiewaarschuwing</td>
          <td>Controleer RD Licensing-configuratie en CAL-status.</td>
        </tr>
        <tr>
          <td>Web Access toont geen apps</td>
          <td>Controleer RemoteApp-publicatie en gebruikersrechten.</td>
        </tr>
        <tr>
          <td>Externe toegang via Gateway mislukt</td>
          <td>Controleer SSL-certificaat, CAP/RAP policies, en poort 443 toegankelijkheid.</td>
        </tr>
        <tr>
          <td>Trage sessies of disconnects</td>
          <td>Controleer netwerkbandbreedte, load balancing en performance counters.</td>
        </tr>
      </tbody>
    </table>
  </section>

  <section>
    <h2>üßæ Conclusie</h2>
    <p>
      Na dit lab kun je een complete RDS-omgeving opzetten, configureren en beveiligen binnen Hyper-V. 
      Je begrijpt de rol van Session Hosts, Connection Brokers, Licensing, Web Access en Gateway, 
      en kunt gebruikers veilige, schaalbare en flexibele toegang geven tot desktop- en applicatieomgevingen. 
      Dit vormt de basis voor geavanceerde VDI (Virtual Desktop Infrastructure) implementaties.
    </p>
  </section>
</article>
