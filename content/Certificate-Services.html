<section>
  <h1>ğŸ” Active Directory Certificate Services (AD CS) â€“ Installatie, Configuratie en Beheer</h1>

  <section>
    <h2>ğŸ¯ Doelstelling</h2>
    <p>
      In dit lab leer je hoe je <strong>Active Directory Certificate Services (AD CS)</strong> installeert en configureert
      voor gebruik binnen een Windows Server-domeinomgeving. AD CS biedt een interne <strong>Public Key Infrastructure (PKI)</strong>
      waarmee je beveiligingscertificaten kunt uitgeven, beheren en intrekken voor computers, gebruikers en servers.
    </p>
  </section>

  <section>
    <h2>ğŸ§° Voorwaarden</h2>
    <ul>
      <li>Windows Server met domeinlidmaatschap (<code>lab.local</code> bijvoorbeeld)</li>
      <li>Administratorrechten</li>
      <li>Statische IP en correcte DNS-configuratie</li>
      <li>Servernaam mag niet wijzigen na installatie van AD CS</li>
    </ul>
  </section>

  <section>
    <h2>âš™ï¸ Installatie van AD CS</h2>
    <ol>
      <li>Open <strong>Server Manager â†’ Add Roles and Features</strong>.</li>
      <li>Kies <strong>Role-based or feature-based installation</strong>.</li>
      <li>Selecteer de gewenste server en vink aan:
        <ul>
          <li><strong>Active Directory Certificate Services</strong></li>
        </ul>
      </li>
      <li>Bij de rolservices, vink aan:
        <ul>
          <li><strong>Certification Authority (CA)</strong></li>
          <li><strong>Certification Authority Web Enrollment</strong> (optioneel)</li>
          <li><strong>Online Responder</strong> (optioneel, voor CRL-verificatie)</li>
        </ul>
      </li>
      <li>Klik <strong>Next â†’ Install</strong>.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
Install-WindowsFeature AD-Certificate -IncludeManagementTools
        </code></pre>
      </li>
    </ol>
  </section>

  <section>
    <h2>ğŸ—ï¸ Configuratie van de Certification Authority</h2>
    <ol>
      <li>Na installatie, klik in Server Manager op <strong>Configure Active Directory Certificate Services</strong>.</li>
      <li>Kies het serviceaccount: <strong>Built-in Administrator</strong> of een domeinaccount met CA-rechten.</li>
      <li>Selecteer <strong>Certification Authority</strong> en klik <strong>Next</strong>.</li>
      <li>Kies CA-type:
        <ul>
          <li><strong>Enterprise CA:</strong> integreert met Active Directory â†’ automatische certificaatregistratie (aanbevolen)</li>
          <li><strong>Standalone CA:</strong> geen AD-integratie, handmatige goedkeuring</li>
        </ul>
      </li>
      <li>Kies <strong>Root CA</strong> (eerste CA in de hiÃ«rarchie).</li>
      <li>Kies â€œCreate a new private keyâ€ en laat standaardinstellingen staan:
        <ul>
          <li>Key length: 2048 of 4096 bits</li>
          <li>Hashing: SHA256</li>
        </ul>
      </li>
      <li>Geef een <strong>CA Common Name</strong> op, bijvoorbeeld <code>LAB-CA</code>.</li>
      <li>Bewaar databasebestanden op standaardlocatie (<code>C:\Windows\System32\CertLog</code>).</li>
      <li>Voltooi de wizard.</li>
    </ol>
  </section>

  <section>
    <h2>ğŸ“œ Certificaatuitgifte testen</h2>
    <ol>
      <li>Open <strong>Certification Authority Console (certsrv.msc)</strong>.</li>
      <li>Klik op <strong>Issued Certificates</strong> om eerder uitgegeven certificaten te zien.</li>
      <li>Voor handmatige aanvraag:
        <ul>
          <li>Open <strong>mmc.exe â†’ Certificates â†’ Computer Account â†’ Personal â†’ Certificates</strong>.</li>
          <li>Rechtsklik â†’ <strong>All Tasks â†’ Request New Certificateâ€¦</strong></li>
          <li>Kies een template (bijv. Computer of Web Server) â†’ <strong>Enroll</strong>.</li>
        </ul>
      </li>
      <li>Controleer in de CA-console dat het certificaat werd uitgegeven.</li>
    </ol>

    <h3>PowerShell alternatief:</h3>
    <pre><code class="language-powershell">
# Certificaat aanvragen via PowerShell
certreq -new request.inf request.req
certreq -submit request.req request.cer
certreq -accept request.cer
    </code></pre>
  </section>

  <section>
    <h2>ğŸ”§ Certificatensjablonen (Templates)</h2>
    <ol>
      <li>Open de CA-console â†’ <strong>Certificate Templates</strong>.</li>
      <li>Rechtsklik â†’ <strong>Manage</strong> â†’ opent MMC met alle templates.</li>
      <li>Kopieer een bestaand template, bijvoorbeeld <strong>Web Server</strong>.</li>
      <li>Geef een nieuwe naam (bijv. â€œIIS SSL Templateâ€).</li>
      <li>Pas aan:
        <ul>
          <li><strong>Security-tab:</strong> geef â€œDomain Computersâ€ of specifieke groepen â€œEnrollâ€ en â€œAutoenrollâ€ rechten.</li>
          <li><strong>Subject Name:</strong> laat door AD bepalen (voor automatische invulling).</li>
        </ul>
      </li>
      <li>Sla op en publiceer het template:
        <pre><code class="language-powershell">
certutil -setcatemplates +IIS_SSL_Template
        </code></pre>
      </li>
      <li>Nu kunnen servers automatisch een certificaat aanvragen via AD.</li>
    </ol>
  </section>

  <section>
    <h2>âš™ï¸ Automatische certificaatregistratie (Autoenrollment)</h2>
    <p>Met Autoenrollment kunnen domeinleden automatisch certificaten aanvragen zonder handmatige actie.</p>
    <ol>
      <li>Open <strong>Group Policy Management Console (gpmc.msc)</strong>.</li>
      <li>Bewerk het <strong>Default Domain Policy</strong> (of maak een nieuwe GPO).</li>
      <li>Navigeer naar:
        <ul>
          <li><code>Computer Configuration â†’ Policies â†’ Windows Settings â†’ Security Settings â†’ Public Key Policies â†’ Certificate Services Client â€“ Auto-Enrollment</code></li>
        </ul>
      </li>
      <li>Stel in op:
        <ul>
          <li><strong>Configuration Mode:</strong> Enabled</li>
          <li><strong>Renew expired certificates, update pending certificates</strong></li>
          <li><strong>Update certificates that use certificate templates</strong></li>
        </ul>
      </li>
      <li>Voer <code>gpupdate /force</code> uit op clients om het te testen.</li>
      <li>Controleer certificaten in MMC onder <strong>Personal â†’ Certificates</strong>.</li>
    </ol>
  </section>

  <section>
    <h2>ğŸ§© Certificate Revocation List (CRL)</h2>
    <p>De CRL (intrekkingslijst) bevat certificaten die niet langer geldig zijn. Clients controleren deze lijst om certificaatvertrouwen te waarborgen.</p>
    <ul>
      <li>De CA publiceert de CRL standaard op <code>http://CA-Server/certenroll/</code>.</li>
      <li>Controleer publicatie via:
        <pre><code class="language-powershell">
certutil -crl
certutil -urlfetch -verify certificate.cer
        </code></pre>
      </li>
      <li>Zorg dat de locatie (CDP/CRL Distribution Point) toegankelijk is voor alle domeinleden.</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ§  Best practices</h2>
    <ul>
      <li>Gebruik een <strong>Enterprise Root CA</strong> enkel voor lab of kleine omgeving â€” in productie: gebruik hiÃ«rarchie (Root + Issuing CA).</li>
      <li>Bewaar de CA private key offline of beveilig met HSM.</li>
      <li>Gebruik certificaten met een beperkte levensduur (1 jaar voor servers, 2 jaar voor clients).</li>
      <li>Implementeer automatische verlenging via GPOâ€™s.</li>
      <li>Gebruik een aparte Web Enrollment server als je certificaten extern wilt aanvragen.</li>
      <li>Controleer regelmatig de CRL-publicatie en expiratie.</li>
    </ul>
  </section>

  <section>
    <h2>ğŸ§¾ Conclusie</h2>
    <p>
      Active Directory Certificate Services biedt een krachtige, geÃ¯ntegreerde oplossing om beveiligingscertificaten
      binnen het domein te beheren. Door correcte configuratie van templates, auto-enrollment en CRL-publicatie
      kun je SSL, authenticatie en encryptie in je infrastructuur centraal beheren.
    </p>
  </section>
</section>
