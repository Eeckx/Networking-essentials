<article class="content">
  <h1>Hyper-V File Services Lab</h1>

  <section>
    <h2>üéØ Doelstelling</h2>
    <p>
      Dit lab leert je hoe je File Services installeert, configureert en valideert binnen een Hyper-V VM. 
      Je leert netwerkshares, NTFS-permissies, hidden shares, PowerShell beheer, auditing, beveiliging en troubleshooting.
    </p>
  </section>

  <section class="infra-flex">
    <h3>üß© Benodigde infrastructuur</h3>

    <div class="infra-flex-row header">
      <div>Component</div>
      <div>Minimumvereisten</div>
      <div>Aanbevolen</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Component">Hyper-V VM</div>
      <div data-label="Minimumvereisten">Windows Server 2019/2022, 2 vCPU, 4 GB RAM, 40 GB VHDX</div>
      <div data-label="Aanbevolen">4 vCPU, 8 GB RAM, 60 GB VHDX</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Component">Netwerk</div>
      <div data-label="Minimumvereisten">Internal of External switch</div>
      <div data-label="Aanbevolen">Internal + External switch voor test en internet toegang</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Component">PowerShell</div>
      <div data-label="Minimumvereisten">Windows PowerShell 5.1+</div>
      <div data-label="Aanbevolen">PowerShell 7 of hoger</div>
    </div>
  </section>

  <section>
    <h2>üèóÔ∏è Installatie en Configuratie van File Services</h2>

    <h3>Stap 1 ‚Äì File Services rol installeren</h3>
    <ol>
      <li>Open <strong>Server Manager ‚Üí Add Roles and Features</strong>.</li>
      <li>Selecteer <strong>File and Storage Services ‚Üí File and iSCSI Services</strong>.</li>
      <li>Vink aan:
        <ul>
          <li>File Server</li>
          <li>Optioneel: BranchCache, DFS Namespaces, DFS Replication</li>
        </ul>
      </li>
      <li>Installeer de rol en wacht tot voltooiing.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
Install-WindowsFeature FS-FileServer -IncludeManagementTools
        </code></pre>
      </li>
    </ol>

    <h3>Stap 2 ‚Äì Share aanmaken</h3>
    <ol>
      <li>Open <strong>Server Manager ‚Üí File and Storage Services ‚Üí Shares ‚Üí New Share</strong>.</li>
      <li>Kies share type:
        <ul>
          <li>SMB Share ‚Äì Quick (standaard)</li>
          <li>SMB Share ‚Äì Advanced (meer opties zoals offline files)</li>
        </ul>
      </li>
      <li>Configureer share name, physical path en optioneel access-based enumeration.</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
New-Item -Path "D:\Shares\Public" -ItemType Directory
New-SmbShare -Name "Public" -Path "D:\Shares\Public" -FullAccess "Domain Admins" -ChangeAccess "Users"
        </code></pre>
      </li>
    </ol>

    <h4>Extra tip ‚Äì Hidden Share</h4>
    <p>Voeg een <code>$</code> achter de share-naam om deze verborgen te maken. Toegankelijk via directe padtoegang, maar niet zichtbaar in netwerkverkenners.</p>
    <ul>
      <li>PowerShell voorbeeld:
        <pre><code class="language-powershell">
New-SmbShare -Name "Public$" -Path "D:\Shares\Public" -FullAccess "Domain Admins" -ChangeAccess "Users"
        </code></pre>
      </li>
      <li>Toegang via <code>\\SERVER\Public$</code></li>
    </ul>

    <h3>Stap 3 ‚Äì NTFS-permissies instellen</h3>
    <ul>
      <li>Rechtsklik map ‚Üí Properties ‚Üí Security tab</li>
      <li>Stel permissies in (Administrators Full Control, Users Read/Write, specifieke groepen indien nodig)</li>
      <li>NTFS + share-permissies: strengste regel wint</li>
      <li>PowerShell alternatief:
        <pre><code class="language-powershell">
$acl = Get-Acl "D:\Shares\Public"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule("Users","Modify","ContainerInherit,ObjectInherit","None","Allow")
$acl.SetAccessRule($rule)
Set-Acl "D:\Shares\Public" $acl
        </code></pre>
      </li>
    </ul>

    <h3>Stap 4 ‚Äì Toegang testen</h3>
    <ul>
      <li>Map netwerkshare vanaf client of server:
        <pre><code class="language-powershell">
net use Z: \\FILE01.lab.local\Public
dir Z:\
        </code></pre>
      </li>
      <li>Controleer lees-/schrijfrechten</li>
      <li>Test hidden share:
        <pre><code class="language-powershell">
net use Y: \\FILE01.lab.local\Public$
dir Y:\
        </code></pre>
      </li>
    </ul>

    <h3>Stap 5 ‚Äì Geavanceerde configuratie (optioneel)</h3>
    <ul>
      <li>DFS Namespaces, DFS Replication voor centralisatie en redundantie</li>
      <li>Quota instellen via FSRM:
        <pre><code class="language-powershell">
Import-Module FileServerResourceManager
New-FsrmQuota -Path "D:\Shares\Public" -Limit 10GB -Description "Max 10GB per gebruiker"
        </code></pre>
      </li>
      <li>File Screening instellen:
        <pre><code class="language-powershell">
New-FsrmFileScreen -Path "D:\Shares\Public" -Active $true -IncludeGroup "Executable Files"
        </code></pre>
      </li>
    </ul>

    <h3>Stap 6 ‚Äì Auditing en monitoring</h3>
    <ul>
      <li>Activeer auditing:
        <pre><code class="language-powershell">
AuditPol /set /subcategory:"File System" /success:enable /failure:enable
        </code></pre>
      </li>
      <li>Gebruik Event Viewer ‚Üí Security log voor file access events</li>
      <li>Controleer disk usage en performance via Server Manager ‚Üí File and Storage Services ‚Üí Volumes</li>
    </ul>

    <h3>Stap 7 ‚Äì Best practices</h3>
    <ul>
      <li>Aparte volumes voor shares en OS-schijf</li>
      <li>Documenteer share namen, paden en toegangsrechten</li>
      <li>Regelmatig backups maken</li>
      <li>Gebruik snapshots in testomgeving voor snelle herstelopties</li>
      <li>Gebruik hidden shares voor systeem- of beheerdersdata</li>
    </ul>
  </section>

  <section class="infra-flex">
    <h3>üìä Troubleshooting</h3>

    <div class="infra-flex-row header">
      <div>Probleem</div>
      <div>Oplossing</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Probleem">Share niet bereikbaar</div>
      <div data-label="Oplossing">Controleer netwerkconnectiviteit, SMB service, firewall, DNS naam</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Probleem">Gebruiker kan niet schrijven</div>
      <div data-label="Oplossing">Controleer NTFS- en share-permissies, access-based enumeration</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Probleem">Quota overschreden</div>
      <div data-label="Oplossing">Controleer FSRM instellingen en waarschuwingen</div>
    </div>

    <div class="infra-flex-row">
      <div data-label="Probleem">Ongewenste bestanden zichtbaar</div>
      <div data-label="Oplossing">File Screening configureren via FSRM</div>
    </div>
  </section>

  <section>
    <h2>üßæ Conclusie</h2>
    <p>
      Na dit lab kun je File Services installeren, configureren en beheren in een Hyper-V VM, inclusief:
      shares, NTFS-permissies, hidden shares, PowerShell beheer, auditing, quotas, file screening en troubleshooting. 
      Dit lab vormt een stevige basis voor veilige en beheersbare netwerkshares in test- of productieomgevingen.
    </p>
  </section>
</article>
